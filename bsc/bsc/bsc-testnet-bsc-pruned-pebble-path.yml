

services:
  bsc-testnet:
    image: ghcr.io/bnb-chain/bsc:${BSC_VERSION:-1.5.8}
    sysctls:
      net.ipv4.tcp_slow_start_after_idle: 0
      net.ipv4.tcp_no_metrics_save: 1
    user: root
    ports:
      - "10318:10318"
      - "10318:10318/udp"
    expose:                                                                              
      - "8545"                                                                           
    volumes:                                                                             
      - bsc-testnet-bsc-pruned-pebble-path:/root/.ethereum
      - /slowdisk:/slowdisk
    entrypoint: [ "geth" ]
    command:
      - --networkid=97
      - --db.engine=pebble
      - --state.scheme=path
      - --syncmode=snap
      - --gcmode=full
      - --rpc.gascap=600000000
      - --nat=extip:${IP}
      - --miner.gasprice=1000000000
      - --txpool.nolocals
      - --txpool.journal=transactions.rlp
      - --txpool.pricelimit=1000000000
      - --txpool.pricebump=10
      - --txpool.accountslots=200
      - --txpool.globalslots=8000
      - --txpool.accountqueue=200
      - --txpool.globalqueue=4000
      - --gpo.blocks=20
      - --history.transactions=0 
      - --gpo.percentile=60
      - --ipcpath=geth.ipc
      - --http
      - --http.addr=0.0.0.0
      - --http.port=8545
      - --http.vhosts=*
      - --http.api=eth,net,web3,txpool,parlia,debug,admin
      - --ws
      - --ws.addr=0.0.0.0
      - --ws.port=8545
      - --ws.origins=*
      - --ws.api=net,web3,eth,debug
      - --maxpeers=200
      - --nodiscover=false
      - --discovery.port=10318      
      - --port=10318
      - --bootnodes=enode://0637d1e62026e0c8685b1db0ca1c767c78c95c3fab64abc468d1a64b12ca4b530b46b8f80c915aec96f74f7ffc5999e8ad6d1484476f420f0c10e3d42361914b@52.199.214.252:30311,enode://df1e8eb59e42cad3c4551b2a53e31a7e55a2fdde1287babd1e94b0836550b489ba16c40932e4dacb16cba346bd442c432265a299c4aca63ee7bb0f832b9f45eb@52.51.80.128:30311,enode://dbcc5ec23bdf89243688321e8cfa8d80e17edce093206bcc6df998d8148385767cae3058a1c1e20c93c3b8e07962bc7a321deab0aa46c106283f1220f12c220a@3.209.122.123:30311,enode://665cf77ca26a8421cfe61a52ac312958308d4912e78ce8e0f61d6902e4494d4cc38f9b0dd1b23a427a7a5734e27e5d9729231426b06bb9c73b56a142f83f6b68@52.72.123.113:30311      
    restart: unless-stopped
    stop_grace_period: 3m
    networks: 
      - chains
    labels:                                                                              
      - "traefik.enable=true"                                                            
      - "traefik.http.middlewares.bsc-testnet-bsc-pruned-pebble-path-stripprefix.stripprefix.prefixes=/bsc-testnet"             
      - "traefik.http.services.bsc-testnet-bsc-pruned-pebble-path.loadbalancer.server.port=8545"                        
      - "traefik.http.routers.bsc-testnet-bsc-pruned-pebble-path.entrypoints=websecure"                                 
      - "traefik.http.routers.bsc-testnet-bsc-pruned-pebble-path.tls.certresolver=myresolver"                           
      - "traefik.http.routers.bsc-testnet-bsc-pruned-pebble-path.rule=Host(`$DOMAIN`) && PathPrefix(`/bsc-testnet`)"            
      - "traefik.http.routers.bsc-testnet-bsc-pruned-pebble-path.middlewares=bsc-testnet-bsc-pruned-pebble-path-stripprefix, ipwhitelist"

volumes:
  bsc-testnet-bsc-pruned-pebble-path:
